
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data &#8212; Machine Learning in Python</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Modeling and Evaluation" href="imlp_2_modeling.html" />
    <link rel="prev" title="Introduction" href="../intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Machine Learning in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Machine Learning in Python
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imlp_2_modeling.html">
   Modeling and Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imlp_3_experiments.html">
   Experimenation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imlp_4_deep_learning.html">
   Deep Learning
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Setup
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../setup.html">
   Setup
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/imlp/imlp_1_data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/avast/machine-learning-python"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/avast/machine-learning-python/issues/new?title=Issue%20on%20page%20%2Fimlp/imlp_1_data.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/avast/machine-learning-python/master?urlpath=tree/book/imlp/imlp_1_data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-machine-learning">
   What is Machine Learning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#steps-in-almost-every-data-problem">
   Steps in “Almost Every” Data Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-the-problem">
   Define the Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#python">
   Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-and-get-to-know-your-data">
   Load and Get to Know Your Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#complete-correct-create-and-convert">
   Complete, Correct, Create, and Convert
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete">
     Complete
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correct">
     Correct
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#outliers">
       Outliers
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#irregular-cardinality">
       Irregular Cardinality
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create">
     Create
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#date-time-features">
       Date/Time Features
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#contextual-features">
       Contextual Features
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert">
     Convert
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#categorical-features-to-numerical">
       Categorical Features to Numerical
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#one-hot-encoding">
       One-hot Encoding
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploratory-data-analysis">
   Exploratory Data Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical-feature">
     Categorical Feature
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-features">
     Numerical Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical-vs-categorical">
     Categorical vs. Categorical
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical-vs-numerical">
     Categorical vs. Numerical
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#facets">
     Facets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interactions-of-pairs-of-features-using-pair-plots-or-scatter-plots">
     Interactions of Pairs of Features Using Pair Plots or Scatter Plots
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finantial-times-visual-vocabulary">
     Finantial Times Visual Vocabulary
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#covariance">
     Covariance
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlation">
     Correlation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preparation">
   Data Preparation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#normalization">
     Normalization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#binning">
     Binning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fixing-skewness">
     Fixing Skewness
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#box-cox">
       Box-cox
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dimensionality-reduction">
     Dimensionality Reduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#handling-class-imbalance">
     Handling Class Imbalance
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-first-model">
   The First Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#it-looks-too-good-to-be-true">
     It looks too good to be true!
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-machine-learning">
   What is Machine Learning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#steps-in-almost-every-data-problem">
   Steps in “Almost Every” Data Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-the-problem">
   Define the Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#python">
   Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-and-get-to-know-your-data">
   Load and Get to Know Your Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#complete-correct-create-and-convert">
   Complete, Correct, Create, and Convert
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete">
     Complete
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correct">
     Correct
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#outliers">
       Outliers
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#irregular-cardinality">
       Irregular Cardinality
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create">
     Create
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#date-time-features">
       Date/Time Features
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#contextual-features">
       Contextual Features
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert">
     Convert
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#categorical-features-to-numerical">
       Categorical Features to Numerical
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#one-hot-encoding">
       One-hot Encoding
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploratory-data-analysis">
   Exploratory Data Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical-feature">
     Categorical Feature
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-features">
     Numerical Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical-vs-categorical">
     Categorical vs. Categorical
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical-vs-numerical">
     Categorical vs. Numerical
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#facets">
     Facets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interactions-of-pairs-of-features-using-pair-plots-or-scatter-plots">
     Interactions of Pairs of Features Using Pair Plots or Scatter Plots
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finantial-times-visual-vocabulary">
     Finantial Times Visual Vocabulary
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#covariance">
     Covariance
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlation">
     Correlation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preparation">
   Data Preparation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#normalization">
     Normalization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#binning">
     Binning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fixing-skewness">
     Fixing Skewness
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#box-cox">
       Box-cox
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dimensionality-reduction">
     Dimensionality Reduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#handling-class-imbalance">
     Handling Class Imbalance
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-first-model">
   The First Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#it-looks-too-good-to-be-true">
     It looks too good to be true!
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="data">
<h1>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h1>
<p><img alt="What data scientist spent most doing" src="../_images/pie.jpg" /></p>
<p><a class="reference external" href="https://www.forbes.com/sites/gilpress/2016/03/23/data-preparation-most-time-consuming-least-enjoyable-data-science-task-survey-says/#164fea706f63">Gil Press - Forbes, Cleaning Big Data: Most Time-Consuming, Least Enjoyable Data Science Task, Survey Says</a></p>
<div class="section" id="what-is-machine-learning">
<h2>What is Machine Learning<a class="headerlink" href="#what-is-machine-learning" title="Permalink to this headline">¶</a></h2>
<p>Machine learning is automated process that extracts patterns from data. To illustrate basic concepts of machine learning we will use supervised machine learning that automatically learns and builds model of relationships between a set of <em>descriptive features</em> and a <em>target feature</em> (<em>labels</em>) based on a set of historical examples or <em>instances</em>. We can then use this model to make predictions for new instances unseen in learning period.</p>
<p>Following schema illustrates common process of machine learning.</p>
<p><img alt="What is machine learning" src="../_images/machine_learning_1.png" /></p>
</div>
<div class="section" id="steps-in-almost-every-data-problem">
<h2>Steps in “Almost Every” Data Problem<a class="headerlink" href="#steps-in-almost-every-data-problem" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#define">Define the Problem</a></p></li>
<li><p><a class="reference external" href="#load">Load and Get to Know Your Data</a></p></li>
<li><p><a class="reference external" href="#correct">Correct, Complete, Create, and Convert</a></p></li>
<li><p><a class="reference external" href="#eda">Exploratory Data Analysis</a></p></li>
<li><p><a class="reference external" href="#prepare">Prepare Data</a></p></li>
<li><p><a class="reference external" href="#model">Model</a></p></li>
</ol>
<p><a id="define"></a></p>
</div>
<div class="section" id="define-the-problem">
<h2>Define the Problem<a class="headerlink" href="#define-the-problem" title="Permalink to this headline">¶</a></h2>
<p>We are gonna predict <strong>whether it rains tomorrow</strong> from today’s data in locations all over Australia.</p>
<p>It is a <em>binary classification problem</em>, we want also some insights into what features and their values signal rain tomorrow (if any). We got data from <a class="reference external" href="http://www.bom.gov.au/">Australian Weather Bureau</a> for education purposes and downloaded the dataset from <a class="reference external" href="https://www.kaggle.com/jsphyg/weather-dataset-rattle-package">Kaggle Weather dataset</a>.</p>
<p><img alt="" src="../_images/abm.png" /></p>
</div>
<div class="section" id="python">
<h2>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h2>
<p>We will use following libraries in this lecture</p>
<p><a class="reference external" href="https://pandas.pydata.org"><img alt="pandas" src="../_images/pandas.png" /></a>
<a class="reference external" href="https://scikit-learn.org/stable/"><img alt="scikit-learn" src="../_images/scikit1.png" /></a>
<a class="reference external" href="https://numpy.org"><img alt="numpy" src="../_images/numpy.png" /></a></p>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import some basic libraries to do analysis and ML</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sklearn</span> <span class="k">as</span> <span class="nn">sk</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># Visualization details</span>
<span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.offline</span> <span class="k">as</span> <span class="nn">py</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">machine_learning_python</span> <span class="k">as</span> <span class="nn">mlp</span>

<span class="n">png_renderer</span> <span class="o">=</span> <span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">]</span>
<span class="n">png_renderer</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">png_renderer</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><a id="load"></a></p>
</div>
<div class="section" id="load-and-get-to-know-your-data">
<h2>Load and Get to Know Your Data<a class="headerlink" href="#load-and-get-to-know-your-data" title="Permalink to this headline">¶</a></h2>
<p>We load data and have the first look on what is available to us, what features we have, their types, missing values, what might be wrong, what we can fix on our side, what has to be fixed with data provider etc.</p>
<p>It is worth to validate the basic assumptions about the data:</p>
<ul class="simple">
<li><p>Do we have anough samples?</p></li>
<li><p>Are basic axioms valid eg. uniqueness of ids, having one measurement per day, …</p></li>
<li><p>What labels do we have? Is it binary?</p></li>
</ul>
<p>Some features that are available to us:</p>
<ol class="simple">
<li><p><em>RainTomorrow</em> is our binary target (dependent) features we will be predicting or explaining using descriptive (independent) features.</p></li>
<li><p><em>Date</em>, <em>Location</em> are nominal (categorical) features spanning Australia and about 9 years of measurements. We will need to convert it to numerical features. Some locations are close together, some are very distant, we could probably use location to give information about adjacent rain and combine it with wind direction.</p></li>
<li><p><em>WindDir</em>s are nominal features about wind direction. We will have to convert  it to numerical features.</p></li>
<li><p><em>RainToday</em> is nominal info about raining today. We will have to convert  it to numerical features. It will be probably the feature with the most signal as it is likely that when it rains today, it will rain tomorrow.</p></li>
<li><p><em>RISK_MM</em> feature stands out, it looks like some technical measure, we will have to check later.</p></li>
<li><p>There is a group of numerical features describing morning and afternoon measurements. We have to check distributions and fill in missing values.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read data from local .csv file</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../data/weatherAUS.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 142193 entries, 0 to 142192
Data columns (total 24 columns):
 #   Column         Non-Null Count   Dtype  
---  ------         --------------   -----  
 0   Date           142193 non-null  object 
 1   Location       142193 non-null  object 
 2   MinTemp        141556 non-null  float64
 3   MaxTemp        141871 non-null  float64
 4   Rainfall       140787 non-null  float64
 5   Evaporation    81350 non-null   float64
 6   Sunshine       74377 non-null   float64
 7   WindGustDir    132863 non-null  object 
 8   WindGustSpeed  132923 non-null  float64
 9   WindDir9am     132180 non-null  object 
 10  WindDir3pm     138415 non-null  object 
 11  WindSpeed9am   140845 non-null  float64
 12  WindSpeed3pm   139563 non-null  float64
 13  Humidity9am    140419 non-null  float64
 14  Humidity3pm    138583 non-null  float64
 15  Pressure9am    128179 non-null  float64
 16  Pressure3pm    128212 non-null  float64
 17  Cloud9am       88536 non-null   float64
 18  Cloud3pm       85099 non-null   float64
 19  Temp9am        141289 non-null  float64
 20  Temp3pm        139467 non-null  float64
 21  RainToday      140787 non-null  object 
 22  RISK_MM        142193 non-null  float64
 23  RainTomorrow   142193 non-null  object 
dtypes: float64(17), object(7)
memory usage: 26.0+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">10</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Location</th>
      <th>MinTemp</th>
      <th>MaxTemp</th>
      <th>Rainfall</th>
      <th>Evaporation</th>
      <th>Sunshine</th>
      <th>WindGustDir</th>
      <th>WindGustSpeed</th>
      <th>WindDir9am</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>30559</th>
      <td>2011-01-01</td>
      <td>Sydney</td>
      <td>20.5</td>
      <td>29.0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>10.8</td>
      <td>NE</td>
      <td>39.0</td>
      <td>E</td>
    </tr>
    <tr>
      <th>25273</th>
      <td>2013-12-13</td>
      <td>Penrith</td>
      <td>15.9</td>
      <td>33.6</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ENE</td>
      <td>37.0</td>
      <td>SSE</td>
    </tr>
    <tr>
      <th>4088</th>
      <td>2012-02-24</td>
      <td>BadgerysCreek</td>
      <td>15.7</td>
      <td>30.9</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ENE</td>
      <td>30.0</td>
      <td>SSE</td>
    </tr>
    <tr>
      <th>67201</th>
      <td>2013-01-02</td>
      <td>Melbourne</td>
      <td>15.3</td>
      <td>22.2</td>
      <td>0.0</td>
      <td>9.8</td>
      <td>12.7</td>
      <td>SE</td>
      <td>48.0</td>
      <td>SSE</td>
    </tr>
    <tr>
      <th>10038</th>
      <td>2012-02-17</td>
      <td>CoffsHarbour</td>
      <td>17.2</td>
      <td>26.3</td>
      <td>0.4</td>
      <td>5.6</td>
      <td>11.0</td>
      <td>E</td>
      <td>30.0</td>
      <td>W</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>WindDir3pm</th>
      <th>WindSpeed9am</th>
      <th>WindSpeed3pm</th>
      <th>Humidity9am</th>
      <th>Humidity3pm</th>
      <th>Pressure9am</th>
      <th>Pressure3pm</th>
      <th>Cloud9am</th>
      <th>Cloud3pm</th>
      <th>Temp9am</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4186</th>
      <td>NNE</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>100.0</td>
      <td>70.0</td>
      <td>1029.6</td>
      <td>1025.8</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11.8</td>
    </tr>
    <tr>
      <th>65054</th>
      <td>SW</td>
      <td>19.0</td>
      <td>35.0</td>
      <td>78.0</td>
      <td>49.0</td>
      <td>1013.2</td>
      <td>1013.4</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>8.3</td>
    </tr>
    <tr>
      <th>77000</th>
      <td>SW</td>
      <td>6.0</td>
      <td>11.0</td>
      <td>100.0</td>
      <td>78.0</td>
      <td>1024.5</td>
      <td>1023.6</td>
      <td>7.0</td>
      <td>6.0</td>
      <td>9.8</td>
    </tr>
    <tr>
      <th>9479</th>
      <td>S</td>
      <td>20.0</td>
      <td>33.0</td>
      <td>85.0</td>
      <td>61.0</td>
      <td>1023.5</td>
      <td>1021.1</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>14.2</td>
    </tr>
    <tr>
      <th>66180</th>
      <td>SW</td>
      <td>28.0</td>
      <td>28.0</td>
      <td>71.0</td>
      <td>57.0</td>
      <td>1014.5</td>
      <td>1013.6</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>11.4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">20</span><span class="p">:]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Temp3pm</th>
      <th>RainToday</th>
      <th>RISK_MM</th>
      <th>RainTomorrow</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15409</th>
      <td>20.4</td>
      <td>No</td>
      <td>0.0</td>
      <td>No</td>
    </tr>
    <tr>
      <th>46328</th>
      <td>12.5</td>
      <td>No</td>
      <td>0.0</td>
      <td>No</td>
    </tr>
    <tr>
      <th>58628</th>
      <td>12.2</td>
      <td>No</td>
      <td>0.0</td>
      <td>No</td>
    </tr>
    <tr>
      <th>49183</th>
      <td>24.4</td>
      <td>No</td>
      <td>0.4</td>
      <td>No</td>
    </tr>
    <tr>
      <th>93631</th>
      <td>29.6</td>
      <td>No</td>
      <td>0.0</td>
      <td>No</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">Count</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;We have </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="si">}</span><span class="s1"> unique locations.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;We have </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="si">}</span><span class="s1"> days or </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">//</span> <span class="mi">365</span><span class="si">}</span><span class="s1">+ years of measurements.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We have 49 unique locations.
We have 3436 days or 9+ years of measurements.
</pre></div>
</div>
</div>
</div>
<p>Check for duplicated data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Location      Date      
Adelaide      2008-07-01    1
PerthAirport  2013-11-07    1
              2013-11-01    1
              2013-11-02    1
              2013-11-03    1
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>For some locations, we have only about half of samples of other locations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Measurements by Location&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Count&#39;</span><span class="p">:</span> <span class="s1">&#39;Measurements&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_19_0.png" src="../_images/imlp_1_data_19_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># average humidity by location</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">)[[</span><span class="s1">&#39;Humidity3pm&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
    <span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Humidity3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">),</span>
    <span class="n">m</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Humidity3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
    <span class="n">se</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Humidity3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;sem&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>                           

<span class="n">d</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">se</span> <span class="o">*</span> <span class="n">st</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">cnt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">error_y</span><span class="o">=</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Average Humidity3pm by Location&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="s1">&#39;Humidity3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;stack&#39;</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;categoryorder&#39;</span><span class="p">:</span><span class="s1">&#39;total descending&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_20_0.png" src="../_images/imlp_1_data_20_0.png" />
</div>
</div>
<p><a id="complete"></a></p>
</div>
<div class="section" id="complete-correct-create-and-convert">
<h2>Complete, Correct, Create, and Convert<a class="headerlink" href="#complete-correct-create-and-convert" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sunshine         67816
Evaporation      60843
Cloud3pm         57094
Cloud9am         53657
Pressure9am      14014
Pressure3pm      13981
WindDir9am       10013
WindGustDir       9330
WindGustSpeed     9270
WindDir3pm        3778
Humidity3pm       3610
Temp3pm           2726
WindSpeed3pm      2630
Humidity9am       1774
RainToday         1406
Rainfall          1406
WindSpeed9am      1348
Temp9am            904
MinTemp            637
MaxTemp            322
RISK_MM              0
Date                 0
Location             0
RainTomorrow         0
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>There are locations completely missing values for <em>Pressure9am</em>, <em>WindGustSpeed</em>, <em>Pressure3pm</em>. Measurement device is probably not present at these locations at all.</p>
<p>Dropping does not make sense here, we would lose whole locations.</p>
<p>Bear in mind that we will have to implement this selective imputation everywhere we prepare data for this model. We will check later if this imputation is worth it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">Pressure9amCount</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Pressure9am&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">),</span>
                               <span class="n">Pressure3pmCount</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Pressure3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">),</span>
                               <span class="n">WindGustSpeedCount</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;WindGustSpeed&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">))</span>
<span class="n">g</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">Pressure9amCount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Pressure9amCount</th>
      <th>Pressure3pmCount</th>
      <th>WindGustSpeedCount</th>
    </tr>
    <tr>
      <th>Location</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MountGinini</th>
      <td>0</td>
      <td>0</td>
      <td>2715</td>
    </tr>
    <tr>
      <th>Newcastle</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Penrith</th>
      <td>0</td>
      <td>0</td>
      <td>2957</td>
    </tr>
    <tr>
      <th>SalmonGums</th>
      <td>0</td>
      <td>0</td>
      <td>2909</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;If we drop rows with at least one value missing, we get </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">out of </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1"> instances.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>If we drop rows with at least one value missing, we get 56,420 out of 142,193 instances.
</pre></div>
</div>
</div>
</div>
<div class="section" id="complete">
<h3>Complete<a class="headerlink" href="#complete" title="Permalink to this headline">¶</a></h3>
<p>Common strategy is to drop rows with missing values. This could mean dropping substantial amount of data and not being able to predict for many data samples in production. It is always best to check why data are missing and fix them in data collection phase.</p>
<p>Strategies to populate missing values are:</p>
<ol class="simple">
<li><p>Use models that are tolerant to missing values like naive bayes or decision trees.</p></li>
<li><p>Populate categorical data with mode.</p></li>
<li><p>Populate numerical data with mean/median, or using group average.</p></li>
<li><p>Predict missing values using regression from other columns.</p></li>
</ol>
<p>We have features with many missing values eg. <em>Sunshine</em> and features with some missing values eg. <em>Temp3pm</em> probably caused by some malfunction of a measuring unit.</p>
<p>Columns <em>Evaporation</em>, <em>Sunshine</em>, <em>Cloud9am</em>, <em>Cloud3pm</em> have many missing values. We fill-in values using iterative regression on few selected features. When many values are missing in some feature, it is worth to add indicator feature informing ML algorithm that particular value was imputed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">IterativeImputer</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;Yes&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;Yes&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Evaporation&#39;</span><span class="p">,</span> <span class="s1">&#39;Sunshine&#39;</span><span class="p">,</span> <span class="s1">&#39;Cloud9am&#39;</span><span class="p">,</span> <span class="s1">&#39;Cloud3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;Humidity9am&#39;</span><span class="p">,</span> <span class="s1">&#39;Humidity3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;RainToday&#39;</span><span class="p">]</span>
<span class="n">imp</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">initial_strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">add_indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">imp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">_missing&#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">])</span>
<span class="n">d</span><span class="o">.</span><span class="n">head</span><span class="p">()[[</span><span class="s1">&#39;Evaporation&#39;</span><span class="p">,</span> <span class="s1">&#39;Evaporation_missing&#39;</span><span class="p">,</span> <span class="s1">&#39;Sunshine&#39;</span><span class="p">,</span> <span class="s1">&#39;Sunshine_missing&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Evaporation</th>
      <th>Evaporation_missing</th>
      <th>Sunshine</th>
      <th>Sunshine_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>6.251375</td>
      <td>1.0</td>
      <td>6.960355</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.201791</td>
      <td>1.0</td>
      <td>10.762692</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8.671174</td>
      <td>1.0</td>
      <td>11.255441</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8.275212</td>
      <td>1.0</td>
      <td>11.644286</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.537052</td>
      <td>1.0</td>
      <td>4.875672</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="p">[[</span><span class="s1">&#39;Evaporation&#39;</span><span class="p">,</span> <span class="s1">&#39;Evaporation_missing&#39;</span><span class="p">,</span> <span class="s1">&#39;Sunshine&#39;</span><span class="p">,</span> <span class="s1">&#39;Sunshine_missing&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Evaporation</th>
      <th>Evaporation_missing</th>
      <th>Sunshine</th>
      <th>Sunshine_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>142193.000000</td>
      <td>142193.000000</td>
      <td>142193.000000</td>
      <td>142193.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>5.244790</td>
      <td>0.427890</td>
      <td>7.430390</td>
      <td>0.476929</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.475205</td>
      <td>0.494775</td>
      <td>3.374164</td>
      <td>0.499469</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.401327</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.979168</td>
      <td>0.000000</td>
      <td>5.014699</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>4.800000</td>
      <td>0.000000</td>
      <td>7.717306</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>6.800000</td>
      <td>1.000000</td>
      <td>10.100000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>145.000000</td>
      <td>1.000000</td>
      <td>37.475535</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace imputed columns including indicators</span>
<span class="c1"># cols_wo_rt = [c for c in cols if &#39;RainToday&#39; not in c]</span>
<span class="c1"># df.drop(cols_wo_rt, axis=1, inplace=True)</span>
<span class="c1"># cols_wo_rt = cols_wo_rt + [f&#39;{c}_missing&#39; for c in cols if &#39;RainToday&#39; not in c]</span>
<span class="c1"># df = pd.concat([df, d[cols_wo_rt]], axis=1)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Impute the rest with median for numerical features and mode for categorical features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="n">impute_columns_numerical</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;WindGustSpeed&#39;</span><span class="p">,</span> <span class="s1">&#39;Pressure9am&#39;</span><span class="p">,</span> <span class="s1">&#39;Pressure3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;Temp3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;WindSpeed3pm&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Rainfall&#39;</span><span class="p">,</span> <span class="s1">&#39;WindSpeed9am&#39;</span><span class="p">,</span> <span class="s1">&#39;Temp9am&#39;</span><span class="p">,</span> <span class="s1">&#39;MinTemp&#39;</span><span class="p">,</span> <span class="s1">&#39;MaxTemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Evaporation&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;Sunshine&#39;</span><span class="p">,</span> <span class="s1">&#39;Cloud9am&#39;</span><span class="p">,</span> <span class="s1">&#39;Cloud3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;Humidity9am&#39;</span><span class="p">,</span> <span class="s1">&#39;Humidity3pm&#39;</span><span class="p">]</span>

<span class="n">impute_columns_categorical</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;WindGustDir&#39;</span><span class="p">,</span> <span class="s1">&#39;WindDir9am&#39;</span><span class="p">,</span> <span class="s1">&#39;WindDir3pm&#39;</span><span class="p">]</span>    

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">impute_columns_numerical</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">impute_columns_categorical</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Check that we handled everything.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date         0
Location     0
RISK_MM      0
RainToday    0
Temp3pm      0
dtype: int64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="correct">
<h3>Correct<a class="headerlink" href="#correct" title="Permalink to this headline">¶</a></h3>
<p>We review data for striking errors caused by eg. transformations of data on the source, manual input errors, having numerical feature values as nominal (because <code class="docutils literal notranslate"><span class="pre">1</span></code> is not the same as <code class="docutils literal notranslate"><span class="pre">&quot;1&quot;</span></code>), etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># basic overview about distribution of values in numerical columns</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Cloud9am&#39;</span><span class="p">,</span> <span class="s1">&#39;Humidity9am&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Cloud9am</th>
      <th>Humidity9am</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>142193.000000</td>
      <td>142193.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>4.649568</td>
      <td>68.858235</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.294357</td>
      <td>18.932512</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.000000</td>
      <td>57.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>5.000000</td>
      <td>70.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>6.000000</td>
      <td>83.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>9.000000</td>
      <td>100.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># boxplots</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">cols</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">]],</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">facet_col</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="s1">&#39;outliers&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_40_0.png" src="../_images/imlp_1_data_40_0.png" />
</div>
</div>
<div class="section" id="outliers">
<h4>Outliers<a class="headerlink" href="#outliers" title="Permalink to this headline">¶</a></h4>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p><img alt="" src="../_images/boxplot.png" /></p>
</div>
<p>Outliers in data could be real eg. some flooding in <em>Rainfall</em> or could come from faulty measurement. Outliers skew mean of the feature and some ML algorithms calculating distances like linear models for both classification and regression are sensitive to them.</p>
<p>There are different techniques how to handle outliers:</p>
<ol class="simple">
<li><p>Cap values to stay inside inter quartile range.</p></li>
<li><p>Bin numerical feature to create categorical values.</p></li>
<li><p>Apply function transformation that penalizes long-tail outliers eg. taking <span class="math notranslate nohighlight">\(log\)</span> of values.</p></li>
</ol>
<p>We cap numerical feature values <span class="math notranslate nohighlight">\(v\)</span> to stay be within</p>
<div class="math notranslate nohighlight">
\[q_1 - m * \text{IQR} \le v \le q_3 + m * \text{IQR}\]</div>
<p>Where</p>
<ol class="simple">
<li><p><span class="math notranslate nohighlight">\(q_1\)</span> is 25% quartile</p></li>
<li><p><span class="math notranslate nohighlight">\(q_3\)</span> is 75% quartile</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{IQR} = q_3 - q_1\)</span> is inter-quartile range</p></li>
<li><p><span class="math notranslate nohighlight">\(m\)</span> is constant</p></li>
</ol>
<p>IQR is defined as difference between value on 75% quartile (<span class="math notranslate nohighlight">\(q_3\)</span>) and 25% quartile (<span class="math notranslate nohighlight">\(q_1\)</span>). We can use different multiples of IQR for different features, common practice is using <span class="math notranslate nohighlight">\(m = 1.5\)</span> or <span class="math notranslate nohighlight">\(m = 1.8\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">q3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>

<span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">q1</span> <span class="o">-</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">iqr</span><span class="p">,</span> <span class="n">q3</span> <span class="o">+</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">iqr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Cloud9am</th>
      <th>Humidity9am</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>142193.000000</td>
      <td>142193.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>4.649568</td>
      <td>68.911015</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.294357</td>
      <td>18.779092</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>18.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.000000</td>
      <td>57.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>5.000000</td>
      <td>70.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>6.000000</td>
      <td>83.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>9.000000</td>
      <td>100.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fixed distributions</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MinTemp&#39;</span><span class="p">,</span> <span class="s1">&#39;Rainfall&#39;</span><span class="p">,</span> <span class="s1">&#39;WindGustSpeed&#39;</span><span class="p">]</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">cols</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">]],</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">])</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">facet_col</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_47_0.png" src="../_images/imlp_1_data_47_0.png" />
</div>
</div>
</div>
<div class="section" id="irregular-cardinality">
<h4>Irregular Cardinality<a class="headerlink" href="#irregular-cardinality" title="Permalink to this headline">¶</a></h4>
<p>Some numerical features might be better represented as categorical features because they are coded as ordinal numbers (eg. sex coded as 0 and 1) or because they can have only some specified values.</p>
<p>All our numerical columns seem to have reasonable cardinality and there is probably no candidate for categorical type among numerical features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RainTomorrow       2
RainToday          2
Cloud3pm          10
Cloud9am          10
WindDir3pm        16
WindDir9am        16
WindGustDir       16
WindSpeed9am      43
WindSpeed3pm      44
Location          49
WindGustSpeed     67
Humidity9am       83
Humidity3pm      101
Sunshine         145
Evaporation      356
dtype: int64
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create">
<h3>Create<a class="headerlink" href="#create" title="Permalink to this headline">¶</a></h3>
<p>We can use our domain knowledge and available features to create new features to determine if they have signal for predicted outcome. We can parse string features, combine features to discover good interactions and amplification effect. We can also crawl data to enhance data points with historical trends, local context, and additional data sources that are available to us (eg. satelite images) and are joinable to existing data.</p>
<p>We check if there was a drop or rise between morning and afternoon pressure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;PressureDiff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Pressure3pm&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Pressure9am&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;PressureDrop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;PressureDiff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We include it as an indicator and also as absolute value to check what works better in following exploratory data analysis.</p>
<div class="section" id="date-time-features">
<h4>Date/Time Features<a class="headerlink" href="#date-time-features" title="Permalink to this headline">¶</a></h4>
<p>Date and time data usually provide valuable contextual information but we have to transform the data to make it accessible for ML algorithms. Some ML algorithms can work on time series data and learn trends like periodicity.</p>
<p>Common strategies:</p>
<ol class="simple">
<li><p>Extract year, months, days, week days into separate columns to give the model some information about possible periodicity. This is useful eg. when we process transactional data as weekends are always different from weekdays.</p></li>
<li><p>Extract time period between events in data. Eg. how long it was from the last event to the data point.</p></li>
<li><p>Use dates to connect data from additional datasets like holidays, weekends, eg. <a class="reference external" href="https://facebook.github.io/prophet/docs/seasonality,_holiday_effects,_and_regressors.html#modeling-holidays-and-special-events">Facebook Prophet</a>.</p></li>
</ol>
<p>Downside being that when using model in production to predict on one measurement, we have to load preceeing measurements to calculate values for these features. In real-time setting, this requires database lookups.</p>
<p>We extract <em>Year</em> and <em>Month</em> features here. We also add <em>DaysSinceRainWeek</em> to capture how many days passed from the last rain day in rolling week and <em>RainDaysWeek</em> to capture how many days with rain there was in rolling week.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract year and month</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;DateD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;DateD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;DateD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;YearMonth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;YearMonth&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Year</th>
      <th>Month</th>
      <th>YearMonth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2008-12-01</td>
      <td>2008</td>
      <td>12</td>
      <td>2008-12</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2008-12-02</td>
      <td>2008</td>
      <td>12</td>
      <td>2008-12</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2008-12-03</td>
      <td>2008</td>
      <td>12</td>
      <td>2008-12</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2008-12-04</td>
      <td>2008</td>
      <td>12</td>
      <td>2008-12</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2008-12-05</td>
      <td>2008</td>
      <td>12</td>
      <td>2008-12</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">agg_days_since_rain</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="k">else</span> <span class="mi">20</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">agg_rain_days</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">rolling_feature</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">agg_fce</span><span class="p">):</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">by</span><span class="p">,</span> <span class="n">on</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">agg</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">agg_fce</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">agg</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">agg</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="c1"># agg has aggregated values in column val</span>
    <span class="n">agg</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">val</span><span class="p">,</span> <span class="n">on</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">agg</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="s1">&#39;Id&#39;</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">agg</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">agg</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="contextual-features">
<h4>Contextual Features<a class="headerlink" href="#contextual-features" title="Permalink to this headline">¶</a></h4>
<p>We can look beyond single row of data to calculate some contextual features. Keep in mind that when in production mode, we would need to load context for every row we want to predict for from somewhere. In current setting, we can cheaply evaluate if adding such features help performance of the model.</p>
<p>We use last 7 days of data per <em>Location</em> to calculate features</p>
<ol class="simple">
<li><p><em>RainDaysWeek</em> capturing how many times it rained in the last week (excluding given day)</p></li>
<li><p><em>DaysSinceRainWeek</em> capturing how long it is since the last rainy day in the last week.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rolling_feature is custom rolling window function that takes different aggregation functions</span>
<span class="n">dsrw</span> <span class="o">=</span> <span class="n">rolling_feature</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;DateD&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;RainToday&#39;</span><span class="p">]],</span> <span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;DateD&#39;</span><span class="p">,</span> <span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;DaysSinceRainWeek&#39;</span><span class="p">,</span> <span class="n">agg_days_since_rain</span><span class="p">)</span>
<span class="n">rdw</span> <span class="o">=</span> <span class="n">rolling_feature</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;DateD&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;RainToday&#39;</span><span class="p">]],</span> <span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;DateD&#39;</span><span class="p">,</span> <span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;RainDaysWeek&#39;</span><span class="p">,</span> <span class="n">agg_rain_days</span><span class="p">)</span>

<span class="c1"># Prepare original dataset to have the same index as rv</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">d</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Location&#39;</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">((</span><span class="s1">&#39;Id&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Merge new features and drop technical columns</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dsrw</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">])</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">rdw</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">])</span>

<span class="n">d</span><span class="p">[</span><span class="s1">&#39;NoRainWeek&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;DaysSinceRainWeek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">20</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;DaysSinceRainWeek&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;DaysSinceRainWeek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">20</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="n">d</span><span class="p">[(</span><span class="n">d</span><span class="o">.</span><span class="n">Location</span> <span class="o">==</span> <span class="s1">&#39;Melbourne&#39;</span><span class="p">)][[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="s1">&#39;DaysSinceRainWeek&#39;</span><span class="p">,</span> <span class="s1">&#39;NoRainWeek&#39;</span><span class="p">,</span> <span class="s1">&#39;RainDaysWeek&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Location</th>
      <th>RainToday</th>
      <th>DaysSinceRainWeek</th>
      <th>NoRainWeek</th>
      <th>RainDaysWeek</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>65745</th>
      <td>2008-07-01</td>
      <td>Melbourne</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>65746</th>
      <td>2008-07-02</td>
      <td>Melbourne</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>65747</th>
      <td>2008-07-03</td>
      <td>Melbourne</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>65748</th>
      <td>2008-07-04</td>
      <td>Melbourne</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>65749</th>
      <td>2008-07-05</td>
      <td>Melbourne</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>65750</th>
      <td>2008-07-06</td>
      <td>Melbourne</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>65751</th>
      <td>2008-07-07</td>
      <td>Melbourne</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>65752</th>
      <td>2008-07-08</td>
      <td>Melbourne</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>65753</th>
      <td>2008-07-09</td>
      <td>Melbourne</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>65754</th>
      <td>2008-07-10</td>
      <td>Melbourne</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="convert">
<h3>Convert<a class="headerlink" href="#convert" title="Permalink to this headline">¶</a></h3>
<p>Some ML algorithms cannot handle non-numeric values in features like linear models or neural nets. We have to encode categorical features using either dummy values or better using one-hot encoding which helps with colinear features. It is good practice to encode categorical values also for ML algorithms that can handle them like decision trees and forrests of trees to be able to test, use, and combine multiple algorithms.</p>
<div class="section" id="categorical-features-to-numerical">
<h4>Categorical Features to Numerical<a class="headerlink" href="#categorical-features-to-numerical" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;WindGustDir&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>WindGustDir</th>
      <th>Location</th>
      <th>Year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>W</td>
      <td>Albury</td>
      <td>2008</td>
    </tr>
    <tr>
      <th>1</th>
      <td>WNW</td>
      <td>Albury</td>
      <td>2008</td>
    </tr>
    <tr>
      <th>2</th>
      <td>WSW</td>
      <td>Albury</td>
      <td>2008</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NE</td>
      <td>Albury</td>
      <td>2008</td>
    </tr>
    <tr>
      <th>4</th>
      <td>W</td>
      <td>Albury</td>
      <td>2008</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We need to convert categorical values into numerical because many ML algorithms can handle only float numbers on input. We cannot simply assign natural numbers to categories, because numbers encode ordering implicitly and this is then picked by models. For example if we encode <em>North</em> as 0 and <em>South</em> as 1, South is greater than North.</p>
</div>
<div class="section" id="one-hot-encoding">
<h4>One-hot Encoding<a class="headerlink" href="#one-hot-encoding" title="Permalink to this headline">¶</a></h4>
<p><em>One-hot encoding</em> encodes categorical or ordinal features as nominal using “flag columns” or “dummy values” of zeros and ones.</p>
<p>When you have <span class="math notranslate nohighlight">\(N\)</span> distinct values in some feature, we need <span class="math notranslate nohighlight">\(N-1\)</span> flag columns to represent it. The <span class="math notranslate nohighlight">\(N\)</span>th value is represented with all flag columns of zeros. This helps with ML algorithms that are sensitive to colinearity eg. linear and logistic regression without regularization and neural nets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;WindGustDir&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">categories_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;WindGustDir&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>WindGustDir</th>
      <th>ENE</th>
      <th>ESE</th>
      <th>N</th>
      <th>NE</th>
      <th>NNE</th>
      <th>NNW</th>
      <th>NW</th>
      <th>S</th>
      <th>SE</th>
      <th>SSE</th>
      <th>SSW</th>
      <th>SW</th>
      <th>W</th>
      <th>WNW</th>
      <th>WSW</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>W</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>WNW</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>WSW</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NE</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>W</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>East <em>WindGustDir</em> is encoded using all zeros in remaining flag columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">WindGustDir</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>WindGustDir</th>
      <th>ENE</th>
      <th>ESE</th>
      <th>N</th>
      <th>NE</th>
      <th>NNE</th>
      <th>NNW</th>
      <th>NW</th>
      <th>S</th>
      <th>SE</th>
      <th>SSE</th>
      <th>SSW</th>
      <th>SW</th>
      <th>W</th>
      <th>WNW</th>
      <th>WSW</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>76</th>
      <td>E</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>167</th>
      <td>E</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>169</th>
      <td>E</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a id="eda"></a></p>
</div>
</div>
</div>
<div class="section" id="exploratory-data-analysis">
<h2>Exploratory Data Analysis<a class="headerlink" href="#exploratory-data-analysis" title="Permalink to this headline">¶</a></h2>
<p>We explore values in available features to learn their distributions, evaluate their impact on target feature, learn how they interact and study them in detail. The output are learnings, detailed questions to data providers, knowing what transformations we have to apply to data before passing them to ML algorithm.</p>
<div class="section" id="categorical-feature">
<h3>Categorical Feature<a class="headerlink" href="#categorical-feature" title="Permalink to this headline">¶</a></h3>
<p>We could check proportion of positive level of target feature in different levels of categorical feature.</p>
<p>Plotting of confidence intervals gives us some idea about the absolute number and variance of samples in every level of categorical feature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">([</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;PressureDrop&#39;</span><span class="p">,</span> <span class="s1">&#39;RainToday&#39;</span><span class="p">]</span>
<span class="n">categorical_columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Location&#39;,
 &#39;Date&#39;,
 &#39;WindGustDir&#39;,
 &#39;WindDir9am&#39;,
 &#39;WindDir3pm&#39;,
 &#39;YearMonth&#39;,
 &#39;PressureDrop&#39;,
 &#39;RainToday&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">png_renderer</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">png_renderer</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">eda_categorical</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="n">max_categorical_values</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">error_y</span><span class="o">=</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="n">facet_col</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span>
       <span class="n">facet_col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
       <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">})</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_81_0.png" src="../_images/imlp_1_data_81_0.png" />
</div>
</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Annual and monthly rainy days</span>
<span class="n">png_renderer</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">])],</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">error_y</span><span class="o">=</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="n">facet_col</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span>
       <span class="n">facet_col_wrap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
       <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">})</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_82_0.png" src="../_images/imlp_1_data_82_0.png" />
</div>
</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Annual and monthly rainy days</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">eda_categorical</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="s1">&#39;YearMonth&#39;</span><span class="p">]],</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="n">max_categorical_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">([</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;rgba(68, 68, 68, 0.3)&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tonexty&#39;</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_83_0.png" src="../_images/imlp_1_data_83_0.png" />
</div>
</div>
</div>
<div class="section" id="numerical-features">
<h3>Numerical Features<a class="headerlink" href="#numerical-features" title="Permalink to this headline">¶</a></h3>
<p>We check univariate distribution of numerical feature against target variable using histograms or eg. <a class="reference external" href="https://en.wikipedia.org/wiki/Kernel_density_estimation">kernel density</a> plots. If distributions are distinct, we have a good predictive feature.</p>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Does Humidity3pm correlates with RainTomorrow?</span>
<span class="kn">import</span> <span class="nn">plotly.figure_factory</span> <span class="k">as</span> <span class="nn">ff</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">create_distplot</span><span class="p">(</span>
    <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Humidity3pm&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Humidity3pm&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
    <span class="n">bin_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">show_hist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_rug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_curve</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Humidity3pm&#39;</span><span class="p">,</span> <span class="n">legend_title</span><span class="o">=</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_86_0.png" src="../_images/imlp_1_data_86_0.png" />
</div>
</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Does Humidity3pm correlates with RainTomorrow?</span>
<span class="kn">import</span> <span class="nn">plotly.figure_factory</span> <span class="k">as</span> <span class="nn">ff</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">create_distplot</span><span class="p">(</span>
    <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Rainfall&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Rainfall&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
    <span class="n">bin_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">show_hist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_rug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_curve</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Rainfall&#39;</span><span class="p">,</span> <span class="n">legend_title</span><span class="o">=</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="n">xaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_87_0.png" src="../_images/imlp_1_data_87_0.png" />
</div>
</div>
</div>
<div class="section" id="categorical-vs-categorical">
<h3>Categorical vs. Categorical<a class="headerlink" href="#categorical-vs-categorical" title="Permalink to this headline">¶</a></h3>
<p>We can use grouped bar charts to check how are combinations of two categorical features represented in target feature.</p>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Do RainToday and DaysSinceRainWeek or RainDaysWeek influence RainTomorrow?</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">eda_grouped</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="s1">&#39;DaysSinceRainWeek&#39;</span><span class="p">])</span>

<span class="n">d</span><span class="o">.</span><span class="n">DaysSinceRainWeek</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">DaysSinceRainWeek</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;DaysSinceRainWeek&#39;</span><span class="p">,</span> <span class="n">error_y</span><span class="o">=</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_89_0.png" src="../_images/imlp_1_data_89_0.png" />
</div>
</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Do RainToday and DaysSinceRainWeek or RainDaysWeek influence RainTomorrow?</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">eda_grouped</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="s1">&#39;RainDaysWeek&#39;</span><span class="p">])</span>
<span class="n">d</span><span class="o">.</span><span class="n">RainDaysWeek</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">RainDaysWeek</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;RainDaysWeek&#39;</span><span class="p">,</span> <span class="n">error_y</span><span class="o">=</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_90_0.png" src="../_images/imlp_1_data_90_0.png" />
</div>
</div>
</div>
<div class="section" id="categorical-vs-numerical">
<h3>Categorical vs. Numerical<a class="headerlink" href="#categorical-vs-numerical" title="Permalink to this headline">¶</a></h3>
<p>We can use bar charts or violin plots groupped by target feature to check distribution of some numerical feature against values of categorical feature.</p>
<ol class="simple">
<li><p>Bars give us point estimate of the mean value.</p></li>
<li><p>Box plots give us spread, quartiles, and outliers.</p></li>
<li><p>Violin plots give us pdf.</p></li>
</ol>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># More details about numerical feature distribution</span>

<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shared_yaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">eda_categorical</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="s1">&#39;Cloud3pm&#39;</span><span class="p">]],</span> <span class="s1">&#39;Cloud3pm&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">error_y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Cloud3pm&#39;</span><span class="p">]),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Violin</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Cloud3pm&#39;</span><span class="p">],</span> <span class="n">meanline_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;RainToday&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;RainToday&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;RainToday&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Cloud3pm&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">meanline_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_93_0.png" src="../_images/imlp_1_data_93_0.png" />
</div>
</div>
<p>To check impact of category and numerical feature to target feature, we can use color by target feature.</p>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Going deeper and using color</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">eda_grouped</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="s1">&#39;Cloud3pm&#39;</span><span class="p">]],</span> <span class="s1">&#39;Cloud3pm&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">])</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shared_yaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> 
           <span class="n">legendgroup</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
           <span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#2D364C&#39;</span><span class="p">},</span>
           <span class="n">x</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">RainToday</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">error_y</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;array&#39;</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ci&#39;</span><span class="p">]}</span>
    <span class="p">),</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
           <span class="n">legendgroup</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
           <span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#FF7800&#39;</span><span class="p">},</span>
           <span class="n">x</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">RainToday</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">error_y</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;array&#39;</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ci&#39;</span><span class="p">]}),</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> 
           <span class="n">legendgroup</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#2D364C&#39;</span><span class="p">},</span>
           <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RainToday&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Cloud3pm&#39;</span><span class="p">]</span>
    <span class="p">),</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
           <span class="n">legendgroup</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#FF7800&#39;</span><span class="p">},</span>
           <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;RainToday&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Cloud3pm&#39;</span><span class="p">]</span>
    <span class="p">),</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Violin</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span>
              <span class="n">legendgroup</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#2D364C&#39;</span><span class="p">},</span>
              <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RainToday&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Cloud3pm&#39;</span><span class="p">],</span> <span class="n">meanline_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Violin</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
              <span class="n">legendgroup</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#FF7800&#39;</span><span class="p">},</span>
              <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;RainToday&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Cloud3pm&#39;</span><span class="p">],</span> <span class="n">meanline_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">boxmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">violinmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;RainToday&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;RainToday&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;RainToday&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Cloud3pm&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">meanline_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_95_0.png" src="../_images/imlp_1_data_95_0.png" />
</div>
</div>
</div>
<div class="section" id="facets">
<h3>Facets<a class="headerlink" href="#facets" title="Permalink to this headline">¶</a></h3>
<p>We can facet plots by values of some categorical features to investigate interactions of upto 4 features agaist target feature. We generally put target variable on <em>y</em> axis, and use <em>x</em>, <em>columns</em>, <em>rows</em>, and <em>hue</em> for upto 4 explanatory features.</p>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># facets</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">eda_grouped</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;RainDaysWeek&#39;</span><span class="p">,</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">]],</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;RainDaysWeek&#39;</span><span class="p">,</span> <span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">])</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[(</span><span class="n">d</span><span class="o">.</span><span class="n">RainDaysWeek</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)]</span>
<span class="n">d</span><span class="o">.</span><span class="n">RainDaysWeek</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">RainDaysWeek</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">RainToday</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">RainToday</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;RainToday&#39;</span><span class="p">,</span> <span class="n">facet_col</span><span class="o">=</span><span class="s1">&#39;RainDaysWeek&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_98_0.png" src="../_images/imlp_1_data_98_0.png" />
</div>
</div>
</div>
<div class="section" id="interactions-of-pairs-of-features-using-pair-plots-or-scatter-plots">
<h3>Interactions of Pairs of Features Using Pair Plots or Scatter Plots<a class="headerlink" href="#interactions-of-pairs-of-features-using-pair-plots-or-scatter-plots" title="Permalink to this headline">¶</a></h3>
<p>We can use Seaborn <em>pairplot</em> to have analyze interactions and distributions of many features at once. These plots need time to plot and are best used printed :)</p>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># beware this takes long minutes to calculate and display</span>
<span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="s1">&#39;RISK_MM&#39;</span><span class="p">,</span> <span class="s1">&#39;Rainfall&#39;</span><span class="p">,</span> <span class="s1">&#39;Humidity3pm&#39;</span><span class="p">]</span>
<span class="n">png_renderer</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">px</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_100_0.png" src="../_images/imlp_1_data_100_0.png" />
</div>
</div>
</div>
<div class="section" id="finantial-times-visual-vocabulary">
<h3><a class="reference external" href="https://github.com/ft-interactive/chart-doctor/tree/master/visual-vocabulary">Finantial Times Visual Vocabulary</a><a class="headerlink" href="#finantial-times-visual-vocabulary" title="Permalink to this headline">¶</a></h3>
<p><img alt="" src="../_images/ft_poster.png" /></p>
</div>
<div class="section" id="covariance">
<h3>Covariance<a class="headerlink" href="#covariance" title="Permalink to this headline">¶</a></h3>
<p>It is not sometimes straightforward to inspect relationshipe between features visually when there are hundreds or thousands of features. <em>Covariance</em> measures how similarly values of two features <em>A</em> and <em>B</em> behave in relation to their respective means.</p>
<div class="math notranslate nohighlight">
\[\text{cov}(a, b) = \frac{1}{n - 1}\sum_{i=1}^{n}((a_i - \bar{a}) \times (b_i - \bar{b}))\]</div>
<p>Positive values of covariance signal that positive relationship, negative values signal negative relationship and values around <span class="math notranslate nohighlight">\(0\)</span> signal no relationship. Covariance values are in units of features, it makes no sense to compare pairs of features using it.</p>
</div>
<div class="section" id="correlation">
<h3>Correlation<a class="headerlink" href="#correlation" title="Permalink to this headline">¶</a></h3>
<p>Normalized covariance is called <em>correlation</em> and it is in interval <span class="math notranslate nohighlight">\([-1,1]\)</span>.</p>
<div class="math notranslate nohighlight">
\[\text{corr}(a, b) = \frac{\text{cov}(a, b)}{\sigma_a \times \sigma_b}\]</div>
<p>Correlation captures only linear relationshipes between features, there could be more complex relationships like quadratical that we do not discover using correlation. When we calculate correlations for all features, we get correlation matrix good for visual inspection.</p>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># correlations</span>

<span class="n">corr</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">top_corrs</span> <span class="o">=</span> <span class="n">corr</span><span class="p">[</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">corr</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">top_corrs</span><span class="p">)][</span><span class="n">top_corrs</span><span class="p">]</span>

<span class="n">png_renderer</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">png_renderer</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">px</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Correlations&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_106_0.png" src="../_images/imlp_1_data_106_0.png" />
</div>
</div>
<p>Correlation is not causation:</p>
<ol class="simple">
<li><p>Swallows cause hot weather, spinning windmills cause wind, playing basketball causes people to be tall.</p></li>
<li><p>Confounding feature (hidden 3rd factor) eg. young children sleeping with night-light turned on developing short-sightedness</p></li>
</ol>
<p>Causation can be only proved by random experiment.</p>
<p>Features with strong correlation with the target are suspicious and worth investigation. It could be a hint of hidden leaks like time traveling in features etc.</p>
<p><a id="prepare"></a></p>
</div>
</div>
<div class="section" id="data-preparation">
<h2>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="normalization">
<h3>Normalization<a class="headerlink" href="#normalization" title="Permalink to this headline">¶</a></h3>
<p>Features usually vary a lot in their ranges. This is a problem to any ML algorithm using distances like k-nearest neighbors, to PCA which works with variance which is high for high-magnitude features, or to deep learning where it slows down gradient descend or even disables its convergence completely. For example if feature <span class="math notranslate nohighlight">\(x \in [0, 5]\)</span> and feature <span class="math notranslate nohighlight">\(z \in [0, 1000]\)</span> then increase by <span class="math notranslate nohighlight">\(1\)</span> in <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(z\)</span> means something different and we cannot compare it.</p>
<p>Normalize into <span class="math notranslate nohighlight">\([0, 1]\)</span> by</p>
<div class="math notranslate nohighlight">
\[ x_i = \frac{x_i - \min(x)}{\max(x) - min(x)}\]</div>
<p>Standardize by</p>
<div class="math notranslate nohighlight">
\[ x_i = \frac{x_i - \bar{x}}{\sigma_x}\]</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># examples of normalization</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">normalize</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Pressure9am&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">dn</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">d</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">d</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

<span class="n">png_renderer</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shared_yaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fx1</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">create_distplot</span><span class="p">(</span>
    <span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">dn</span><span class="p">,</span> <span class="n">ds</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">curve_type</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span>
    <span class="n">bin_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">show_hist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_rug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_curve</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Normalize&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Standard Scaler&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Pressure9am&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Pressure9am&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Pressure9am&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_113_0.png" src="../_images/imlp_1_data_113_0.png" />
</div>
</div>
</div>
<div class="section" id="binning">
<h3>Binning<a class="headerlink" href="#binning" title="Permalink to this headline">¶</a></h3>
<p>Binning converts continous feature into categorical one for better interpretation of the model, better generalization, and preventing overfitting. Eg. latitude have impact on housing price, but not linear, we could bin latitude to make it categorical.</p>
<p><img alt="" src="../_images/latitude_bin.png" /></p>
<p><a class="reference external" href="https://developers.google.com/machine-learning/data-prep/transform/bucketing">Machine Learning Crash Course, Google</a></p>
<p>We can:</p>
<ol class="simple">
<li><p>Create <strong>equally-wide</strong> bins - does not work well for uni-modal distributions because few bins will have many samples and many bins will cover long tail with few samples each.</p></li>
<li><p>Create <strong>equal-frequency</strong> bins - more appropriate for uni-modal but is less explainable.</p></li>
</ol>
<p>Binning handles outliers automatically.</p>
<p>For categorical data, it might be benefitial to squash low-frequent values under ‘Other’, you do not want necesirily to end up with sparse feature matrices.</p>
</div>
<div class="section" id="fixing-skewness">
<h3>Fixing Skewness<a class="headerlink" href="#fixing-skewness" title="Permalink to this headline">¶</a></h3>
<p>Taking log of values makes exponential or “long-tail” distributions more normal.</p>
<ol class="simple">
<li><p>Logarithm makes comparisons of values of many orders of magnitudes possible eg. change from 1 to 10 is the same as change from 10 000 to 100 000 (consider eg. value of money).</p></li>
<li><p>In many datasets, magnitude order of the data changes within the range of the data.</p></li>
<li><p>It handles outliers.</p></li>
</ol>
<div class="section" id="box-cox">
<h4>Box-cox<a class="headerlink" href="#box-cox" title="Permalink to this headline">¶</a></h4>
<p>Box-cox (power) transformation is generalization of taking <span class="math notranslate nohighlight">\(log\)</span> of features. Box-cox transform first fits <span class="math notranslate nohighlight">\(\lambda\)</span> using maximum log-likelihood method to feature values.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 y_i^{(\lambda)} = 
  \begin{cases} 
   \frac{y_i^\lambda - 1}{\lambda} &amp; \text{if } \lambda \ne 0 \\
   \ln(y_i) &amp; \text{if } \lambda = 0
  \end{cases}
\end{split}\]</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># example of long-tailed distribution</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;WindSpeed9am&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">l</span><span class="p">,</span> <span class="n">lmbda</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shared_yaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fx1</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">create_distplot</span><span class="p">(</span>
    <span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">st</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">lmbda</span><span class="o">=</span><span class="n">lmbda</span><span class="p">)],</span>
    <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">],</span>
    <span class="n">curve_type</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span>
    <span class="n">bin_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">show_hist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_rug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_curve</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;WindSpeed9am&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Log&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sqrt&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Box-Cox&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">fx1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_119_0.png" src="../_images/imlp_1_data_119_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="dimensionality-reduction">
<h3>Dimensionality Reduction<a class="headerlink" href="#dimensionality-reduction" title="Permalink to this headline">¶</a></h3>
<p>High-dimensional datasets can be very difficult to visualize. While data in two or three dimensions can be plotted to show the inherent structure of the data, equivalent high-dimensional plots are much less intuitive. To aid visualization of the structure of a dataset, the dimension must be reduced in some way.</p>
<p>The simplest way to accomplish this dimensionality reduction is by taking a random projection of the data. Though this allows some degree of visualization of the data structure, the randomness of the choice leaves much to be desired. In a random projection, it is likely that the more interesting structure within the data will be lost. <a class="reference external" href="https://scikit-learn.org/stable/modules/manifold.html">Link</a></p>
<p><img alt="" src="../_images/manifold.png" /></p>
<p><a class="reference external" href="https://scikit-learn.org/stable/modules/manifold.html">Scikit-learn Manifold Learning</a></p>
<p>Linear decomposition frameworks like <em>principal component analysis</em> (PCA) and non-linear <em>manifold learning</em> (t-SNE) can make these projections possible and informative. Manifold learning is not that intuitive compared to linear decomposition and needs good parameter tuning (see eg. nice visualization building some intuition in <a class="reference external" href="https://distill.pub/2016/misread-tsne/">How to Use t-SNE Effectively</a>).</p>
<p><img alt="" src="../_images/tsne.png" /></p>
<p><a class="reference external" href="https://distill.pub/2016/misread-tsne">Distill.pub, How to Use t-SNE Effectively</a></p>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># beware, this takes about 30 minutes to compute</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">features</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;Location&#39;</span><span class="p">])]</span>
<span class="n">features</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;YearMonth&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;YearMonth&#39;</span><span class="p">])]</span>
<span class="n">features</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;Humidity3pm&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;Humidity3pm&#39;</span><span class="p">])]</span>

<span class="n">pipeline_pca</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;ct&#39;</span><span class="p">,</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">features</span><span class="p">)),</span>
                         <span class="p">(</span><span class="s1">&#39;sca&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
                         <span class="p">(</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
                        <span class="p">])</span>

<span class="n">pipeline_tsne</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;ct&#39;</span><span class="p">,</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">features</span><span class="p">)),</span>
                          <span class="p">(</span><span class="s1">&#39;sca&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
                          <span class="p">(</span><span class="s1">&#39;tsne&#39;</span><span class="p">,</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="mi">50</span><span class="p">)),</span>
                         <span class="p">])</span>

<span class="n">o_pca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pipeline_pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">d_pca</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">o_pca</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Component 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Component 2&#39;</span><span class="p">,</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">])</span>

<span class="n">o_tsne</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pipeline_tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">d_tsne</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">o_tsne</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Component 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Component 2&#39;</span><span class="p">,</span> <span class="s1">&#39;RainTomorrow&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d_pca</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">=</span> <span class="n">d_pca</span><span class="o">.</span><span class="n">RainTomorrow</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">d_pca</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Component 1&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Component 2&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;PCA Transformation&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">marker_opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_126_0.png" src="../_images/imlp_1_data_126_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d_tsne</span><span class="o">.</span><span class="n">RainTomorrow</span> <span class="o">=</span> <span class="n">d_tsne</span><span class="o">.</span><span class="n">RainTomorrow</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">d_tsne</span><span class="p">[</span><span class="s1">&#39;Component 1&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">d_tsne</span><span class="p">[</span><span class="s1">&#39;Component 2&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">d_tsne</span><span class="p">[</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;t-SNE Transformation&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">marker_opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/imlp_1_data_127_0.png" src="../_images/imlp_1_data_127_0.png" />
</div>
</div>
</div>
<div class="section" id="handling-class-imbalance">
<h3>Handling Class Imbalance<a class="headerlink" href="#handling-class-imbalance" title="Permalink to this headline">¶</a></h3>
<p>In a case where we have 2% to 98% imbalanced dataset, always predicting majority class gives us model with 98% accuracy.</p>
<p>Imbalanced datasets are common. <a class="reference external" href="https://en.wikipedia.org/wiki/Accuracy_paradox">Accuracy paradox</a> tells us that accuracy defined as is not a good metric. Accuracy is defined as number of correctly classified instances / all instances.</p>
<p>Strategies:</p>
<ol class="simple">
<li><p>Use <strong>penalized models</strong> - model pays more when missclassifying minority class.</p></li>
<li><p><strong>Under-sample</strong> majority class if you have many data.</p></li>
<li><p><strong>Over-sample</strong> minority class if you do not have enough data.</p></li>
<li><p>Generate <strong>synthetic samples</strong> using eg. <a class="reference external" href="https://imbalanced-learn.readthedocs.io/en/stable/index.html">imblearn</a>’s SMOTE or Synthetic Minority Oversampling Technique.</p></li>
<li><p>Use precission, recall, f1-score to evaluate model, they do not have accuracy paradox.</p></li>
<li><p>Change model, eg. random forests are not that sensitive to imbalanced datasets.</p></li>
</ol>
<p>When doing over-sampling, always sample after splitting the dataset into training and testing (, validation) datasets.</p>
<p>Over-sampling Using SMOTE and ADASYN Techniques</p>
<p><img alt="" src="../_images/decision_random.png" /></p>
<p><img alt="" src="../_images/decision_smote.png" /></p>
<p><img alt="" src="../_images/decision_adasyn.png" /></p>
<p>Decision boundaries.</p>
<p><img alt="" src="../_images/over_sampling_models.png" /></p>
<p><a class="reference external" href="https://imbalanced-learn.readthedocs.io/en/stable/auto_examples/over-sampling/plot_comparison_over_sampling.html#more-advanced-over-sampling-using-adasyn-and-smote">Imbalanced-learn: A Python Toolbox to Tackle the Curse of Imbalanced Datasets in Machine Learning</a>.</p>
<p>Our dataset is slightly imbalanced, we will see how different algorithms handle this in the next lesson.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    110316
1     31877
Name: RainTomorrow, dtype: int64
</pre></div>
</div>
</div>
</div>
<p><a id="model"></a></p>
</div>
</div>
<div class="section" id="the-first-model">
<h2>The First Model<a class="headerlink" href="#the-first-model" title="Permalink to this headline">¶</a></h2>
<p>Let’s try to combine all we learned into one dataset and let’s use some simple model on it.</p>
<p>We first encode categorical feature using OHE.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">([</span><span class="s1">&#39;float64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">([</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">numeric_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">)</span>
<span class="n">numeric_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">)</span>

<span class="n">ohe</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;WindDir9am&#39;</span><span class="p">,</span> <span class="s1">&#39;WindDir3pm&#39;</span><span class="p">,</span> <span class="s1">&#39;WindGustDir&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;YearMonth&#39;</span><span class="p">]])</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">ohe</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">numeric_columns</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;RainTomorrow&#39;</span><span class="p">]]])</span>
</pre></div>
</div>
</div>
</div>
<p>We keep 30% of samples out of sight of the model to have a good way to evaluate model performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Classifition report on testing dataset&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Classifition report on testing dataset
              precision    recall  f1-score   support

         0.0       1.00      1.00      1.00     33079
         1.0       1.00      1.00      1.00      9579

    accuracy                           1.00     42658
   macro avg       1.00      1.00      1.00     42658
weighted avg       1.00      1.00      1.00     42658
</pre></div>
</div>
</div>
</div>
<div class="section" id="it-looks-too-good-to-be-true">
<h3>It looks too good to be true!<a class="headerlink" href="#it-looks-too-good-to-be-true" title="Permalink to this headline">¶</a></h3>
<p>Do you know what the problem could be?</p>
</div>
</div>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>John D. Kelleher et al., <a class="reference external" href="https://www.amazon.com/Fundamentals-Machine-Learning-Predictive-Analytics/dp/0262029448/ref=sr_1_1?keywords=machine+learning+for+predictive+data+analytics&amp;qid=1569507170&amp;sr=8-1">Fundamentals of Machine Learning for Predicitve Data Analytics</a></p></li>
<li><p>Sebastian Raschka, <a class="reference external" href="https://www.amazon.com/Python-Machine-Learning-Sebastian-Raschka-ebook/dp/B00YSILNL0">Python Machine Learning</a></p></li>
<li><p><a class="reference external" href="https://www.kaggle.com/ldfreeman3/a-data-science-framework-to-achieve-99-accuracy/notebook">A Data Science Framework to chieve 99% Accuracy</a></p></li>
<li><p><a class="reference external" href="https://developers.google.com/machine-learning/data-prep">Google - Machine Learning Crash Course</a></p></li>
</ol>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "machine-learning-python",
            path: "./imlp"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'machine-learning-python'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Introduction</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="imlp_2_modeling.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Modeling and Evaluation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Ondra Zahradnik, Martin Neznal & Data Science Team at Avast<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>